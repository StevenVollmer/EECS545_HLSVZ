# CUSTOM config for MultiAgent with local ollama qwen model
# Example useage:
# sweagent run \
#   --config config/custom_configs/multi_agent.yaml
#   --env.repo.github_url=https://github.com/SWE-agent/test-repo \
#   --problem_statement.github_url=https://github.com/SWE-agent/test-repo/issues/1

# or

# sweagent run \
#   --config config/custom_configs/multi_agent_planner.yaml
#   --env.repo.github_url=https://github.com/SWE-agent/test-repo \
#   --problem_statement.text="Add a simple hello world function to a new file named hello.py."

# used for running on run-batch on swe bench test
# instances:
#   type: swe_bench
#   subset: lite # can also be verified, full
#   split: dev # can also be test
#   slice: :1 # just the first problem

# This config shows the use of the thought_action action parser together with the line-range based replace tools
# This config is close to SWE-agent 0.7

# sweagent run --config SWE-agent/config/custom_configs/multi_agent.yaml \


env: 
  repo:
    github_url: "https://github.com/SWE-agent/test-repo"

problem_statement:
  id: "multi_agent_test"
  type: "text"
  text: "Add a simple hello world function to a new file named hello.py."

agent:
  type: multi
  model:
    name: ollama/qwen2.5-coder:7b-instruct
    api_base: http://localhost:11434
    per_instance_cost_limit: 0
    total_cost_limit: 0
    per_instance_call_limit: 10
    temperature: 0.0
    max_input_tokens: 100000
  roles:
    planner:
      system_template: |-
        You are an experienced programmer that can interact with a computer to solve tasks.
        You have expertise in reviewing code for issues and developing step by step plans for other coders to execute.
      instance_template: |-
        <uploaded_files>
        {{working_dir}}
        </uploaded_files>
        I've uploaded a python code repository in the directory {{working_dir}}. Consider the following PR description:

        <pr_description>
        {{problem_statement}}
        </pr_description>

        Can you help me develop a plan to make the necessary changes to the repository so that the requirements specified in the <pr_description> are met?
        I've already taken care of all changes to any of the test files described in the <pr_description>. This means you DON'T have to modify the testing logic or any of the tests in any way!
        
        Your task is to make develop a plan to make the minimal changes to non-tests files in the {{working_dir}} directory to ensure the <pr_description> is satisfied.
        Follow these steps to resolve the issue:
        1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>
        2. Create a step-by-step plan to solve the problem. Another coder will use your plan to solve the problem step by step.
        Your thinking should be thorough and so it's fine if it's very long.

        Before calling a tool, you must first output a detailed 'THOUGHT:' block explaining your reasoning.
      next_step_template: |-
        OBSERVATION:
        {{observation}}
      next_step_no_output_template: |-
        Your command ran successfully and did not produce any output.
    coder:
      system_template: |-
        You are an experienced programmer that can interact with a computer to solve tasks.
        You have expertise in following a step by step plan for solving complex coding issues.
      instance_template: |-
        <uploaded_files>
        {{working_dir}}
        </uploaded_files>
        I've uploaded a python code repository in the directory {{working_dir}}. Consider the following PR description:

        <pr_description>
        {{problem_statement}}
        </pr_description>

        Another experienced programmer has developed a plan for resolving the issue. You are on step {{step_num}} of that plan.

        Your task is to now execute this step in the plan of action.
      next_step_template: |-
        OBSERVATION:
        {{observation}}
      next_step_no_output_template: |-
        Your command ran successfully and did not produce any output.
    reviewer:
      system_template: |-
        You are an experienced programmer that can interact with a computer to solve tasks.
        You have expertise in reviewing patches to to complex coding issues.
      instance_template: |-
        Can you review the suggested fixes for any errors?
      next_step_template: |-
        OBSERVATION:
        {{observation}}
      next_step_no_output_template: |-
        Your command ran successfully and did not produce any output.
  tools:
    env_variables:
      WINDOW: 100
      OVERLAP: 2
    bundles:
      - path: tools/registry
      - path: tools/windowed
      - path: tools/search
      - path: tools/windowed_edit_linting
      - path: tools/submit
    enable_bash_tool: true
    parse_function:
      type: thought_action # function_calling
    str_replace_editor:
      arguments:
      - name: view_range
        argument_format: "--view_range {{value}}"
    execution_timeout: 60 # how long a model's bash command is allowed to run in the Docker environment
    # registry_variables:
    #   USE_FILEMAP: 'true'
    #   SUBMIT_REVIEW_MESSAGES:
    #     - |
    #       Thank you for your work on this issue. Please carefully follow the steps below to help review your changes.

    #       1. If you made any changes to your code after running the reproduction script, please run the reproduction script again.
    #         If the reproduction script is failing, please revisit your changes and make sure they are correct.
    #         If you have already removed your reproduction script, please ignore this step.
    #       2. Remove your reproduction script (if you haven't done so already).
    #       3. If you have modified any TEST files, please revert them to the state they had before you started fixing the issue.
    #         You can do this with `git checkout -- /path/to/test/file.py`. Use below <diff> to find the files you need to revert.
    #       4. Run the submit command again to confirm.

    #       Here is a list of all of your changes:

    #       <diff>
    #       {{diff}}
    #       </diff>
  history_processors: []
    # - type: remove_regex # might be useful later on
    #   n: 5 """Keep the last n history items unchanged"""
    #   remove:   """Regex patterns to remove from history items"""



# class name GenericAPIModelConfig

# for use later on when making sub-models 
# planner:
#   temperature: 0.3
#   max_tokens: 2048

# coder:
#   temperature: 0.1
#   max_tokens: 4096

# reflection:
#   temperature: 0.2
#   max_tokens: 2048
