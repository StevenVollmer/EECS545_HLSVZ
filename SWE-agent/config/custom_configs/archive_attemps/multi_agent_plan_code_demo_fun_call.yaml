# CUSTOM config for MultiAgent with local ollama qwen model
# 
# This is base on SWE-agent/config/sweagent_0_7/07_thought_action.yaml
# 
# call with:
# 
# sweagent run --config SWE-agent/config/custom_configs/multi_agent_plan_code_demo.yaml
env:
  repo:
    github_url: "https://github.com/SWE-agent/test-repo"

problem_statement:
  id: "multi_agent_plan_code_demo_fun_call_test_1"
  type: "text"
  # text: "Add a simple hello world function to a new file in the root directory. Name the file hello.py. Within the file, call your new function to check that it outputs the expected test."
  text: "Add a simple hello world function to a new file named hello.py."
  # type: github
  # github_url: "https://github.com/SWE-agent/test-repo/issues/1"

agent:
  type: multi
  model:
    name: ollama/qwen2.5-coder:7b-instruct
    api_base: http://localhost:11434
    per_instance_call_limit: 4
    temperature: 0.0
    max_input_tokens: 120000
  templates:
    system_template: |-
      Empty
    instance_template: |-
      Empty
  roles:
    planner:
      system_template: |-
        SETTING: You are a lead software architect. Your ONLY goal is to research the repo and write a step-by-step implementation plan. Your plan will teach another programmer how to solve the problem.

        You're working directly in the command line with a special interface. The special interface consists of a file editor that shows you {{WINDOW}} lines of a file at a time.
        In addition to typical bash commands, you can also use specific commands to help you navigate and edit files. To call a command, you need to invoke it with a function call/tool call.

        Please note that THE EDIT COMMAND REQUIRES PROPER INDENTATION.
        If you'd like to add the line '        print(x)' you must fully write that out, with all those spaces before the code! Indentation is important and code that is not indented correctly will fail and require fixing before it can be run.
        You're free to use any other bash commands you want (e.g. find, grep, cat, ls, cd) in addition to the special commands listed above.
        However, the environment does NOT support interactive session commands (e.g. python, vim), so please do not invoke them.

        RESPONSE FORMAT:
        Your shell prompt is formatted as follows:
        (Open file: <path>)
        (Current directory: <cwd>)
        bash-$

        First, you should _always_ include a general thought about what you're going to do next. Then, for every response, you must include exactly _ONE_ tool call/function call.

        Remember, you should always include a _SINGLE_ tool call/function call and then wait for a response from the shell before continuing with more discussion and commands. Everything you include in the DISCUSSION section will be saved for future reference.
        If you'd like to issue two commands at once, PLEASE DO NOT DO THAT! Please instead first submit just the first tool call, and then after receiving a response you'll be able to issue the second tool call.
        Note that the environment does NOT support interactive session commands (e.g. python, vim), so please do not invoke them.

      instance_template: |-
        Consider the following PR description:
        <pr_description>
        {{problem_statement}}
        </pr_description>

        TASK: Develop a step by step plan to resolve the above PR description. Write your plan in a file called plan.txt, then call handoff.

        INSTRUCTIONS:
        Now, you're going to develop a plan on your own. Your terminal session has started and you're in the repository's root directory. You can use any bash commands or the special interface to help you.
        Remember, YOU SHOULD ALWAYS INCLUDE EXACTLY ONE TOOL CALL/FUNCTION CALL PER RESPONSE.
        Do not edit any of the source code. Instead, read and examine the repository, consider the PR description, and write your plan to plan.txt

        Follow these steps:
        Step 1: Find and read code relevant to the <pr_description>
        Step 2: Write a detailed step by step plan to 'plan.txt'. 
        Step 3: READ 'plan.txt' to verify its contents.
        Step 4: When you are satisfied with plan.txt, call `handoff`.

        DO NOT TRY TO EXECUTE THE PLAN OR RESOLVE THE PR DESCRIPTION. Another programmer will follow your plan.txt to solve the PR description.

        IMPORTANT TIPS:
        - If you run a command and it doesn't work, try running a different command. A command that did not work once will not work the second time unless you modify it!

        - If you open a file and need to get to an area around a specific line that is not in the first 100 lines, say line 583, don't just use the scroll_down command multiple times. Instead, use the goto 583 command. It's much quicker.

        - If the bug reproduction script requires inputting/reading a specific file, such as buggy-input.png, and you'd like to understand how to input that file, conduct a search in the existing repo code, to see whether someone else has already done that. Do this by running the command: find_file "buggy-input.png" If that doesn't work, use the linux 'find' command.

        - Always make sure to look at the currently open file and the current working directory (which appears right after the currently open file). The currently open file might be in a different directory than the working directory! Note that some commands, such as 'create', open files, so they might change the current open file.

        (Open file: {{open_file}})
        (Current directory: {{working_dir}})
        bash-$
      next_step_template: |-
        {{observation}}
        (Open file: {{open_file}})
        (Current directory: {{working_dir}})
        bash-$
      next_step_no_output_template: |-
        Your command ran successfully and did not produce any output.
        (Open file: {{open_file}})
        (Current directory: {{working_dir}})
        bash-$
      max_observation_length: 3000
      demonstration_template: |
        Here is a demonstration of how to correctly accomplish this task. It is included to show you how to correctly use the interface. You do not need to follow exactly what is done in the demonstration.
        --- DEMONSTRATION ---
        {{demonstration}}
        --- END OF DEMONSTRATION ---
      demonstrations:
        - trajectories/demonstrations/replay__marshmallow-code__marshmallow-1867__function_calling__install-1/marshmallow-code__marshmallow-1867.traj
      put_demos_in_history: true
    coder:
      system_template: |-
        You are the CODER. Your first command MUST be: `cat plan.txt`
        
        ### ANTI-HALLUCINATION RULES:
        1. **Check Before Edit**: Always `cat` a file before editing to confirm line numbers.
        2. **Verify After Edit**: Immediately after an `edit` or `create` command, use `cat` or `grep` to verify the change was applied correctly.
        3. **No Infinite Loops**: If a command fails or produces the same result twice, you MUST change your approach (e.g., use a different bash command).
        4. **Stop on Success**: Once the task is complete, run the code (if applicable) and then call `submit`.

        Available commands:
        {{command_docs}}

        OUTPUT FORMAT (MANDATORY):
        DISCUSSION:
        <short summary of what you just saw and what you will do next>
        ACTION:
        ```
        <exactly one command>
        ```

      instance_template: |-
        TASK: {{problem_statement}}
        
        Start by running `cat plan.txt` to initialize your workspace.
        
        (Open: {{open_file}}) (Dir: {{working_dir}})
        bash-$
      next_step_template: |-
        {{observation}}
        (Open: {{open_file}}) (Dir: {{working_dir}})
        bash-$
      next_step_no_output_template: "Command successful, no output.\nbash-$"
      max_observation_length: 3000

  tools:
    env_variables:
      WINDOW: 100
      OVERLAP: 2
    bundles:
      - path: tools/registry
      - path: tools/windowed
      - path: tools/search
      - path: tools/windowed_edit_linting
      - path: tools/submit
      - path: tools/handoff
    enable_bash_tool: true
    parse_function:
      type: function_calling # thought_action
    execution_timeout: 60